<!DOCTYPE HTML>
<html>
	<head>
		<script type="text/javascript" src="Scripts/Chart.min.js"></script>
		<script type="text/javascript" src="Scripts/jquery-1.10.1.js"></script>
		<script type="text/javascript" src="Scripts/bootstrap.min.js"></script>

		<link href="css/bootstrap.min.css" rel="stylesheet">
		<style>
			body {
				background-color: #f2f2f2;
			}

			.data-type {
				padding-top: 70px;
				font-family: verdana; 
				color: #666666;
			}

			.caption {
				padding-bottom: 20px;
			}

			.caption span {
				font-size: 20pt;
				font-weight: bold;
			}

			#user-name {
				position: absolute;
				right: 0px;
			}

			.newest-measure {
				float: left;
				text-align: center;
				vertical-align: middle;
				font-size: 45pt;
				border-style: groove;
				border-width: 3.5px;
				border-radius: 25px;
				background-color: #f5f5f5;
			}

			.newest-measure i {
				display: block;
				text-align: left;
				padding-left: 15px;
				padding-top: 5px;
				font-size: 15px;
			}

			.newest-measure span {
				font-size: 100pt;
			}
		</style>
	</head>
	<body>

		<div class="navbar navbar-inverse navbar-fixed-top">
			<div class="navbar-inner">
				<div class="container">
					<button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					</button>
					<a class="brand" href="#">NIPEN</a>
					<div class="nav-collapse collapse">
						<ul class="nav">
							<li id="home-button" class="active" onclick="changePage('home-button');"><a href="#">Home</a></li>
							<li id="heart-rate-button" onclick="changePage('heart-rate-button');"><a href="#">Heart Rate</a></li>
							<li id="weight-button" onclick="changePage('weight-button');"><a href="#">Weight</a></li>
							<li id="health-vault-button" onclick="changePage('health-vault-button');"><a href="#">HealthVault</a></li>
						</ul>
					</div>
					<a id="user-name" class="brand" href="#">Ola Nordmann</a>
				</div>
			</div>
		</div>

	    <div class="container">
			<div id="heart-rate" class="data-type">
				<div class="caption">
					<span>Heart Rate</span>
					<a href="api/human/heart_rates">(json)</a>
				</div>

				<div class="newest-measure" id="newest-heart-rate"></div>
				<canvas id="heart-rate-chart"></canvas>
			</div>

			<div id="weight" class="data-type">
				<div class="caption">
					<span>Weight</span>
					<a href="api/human/weights">(json)</a>
				</div>

				<div class="newest-measure" id="newest-weight"></div>
				<canvas id="weight-chart"></canvas>
			</div>

			<div id="health-vault" class="data-type">
				<div class="caption">
					<span>HealthVault</span>
					<a href="#">(json)</a>
				</div>
			</div>
		</div>

		<script type="text/javascript">
			var activePageButton = "home-button";
			var chartWidthFullSize = "900";
			var chartHeightFullSize = "550";

			$(document).ready(function() {
				updatePage();
			});

			function updatePage() {
				initDataType("newest-heart-rate", "heart-rate-chart", "api/human/heart_rates", "hard_coded_json/heart_rates");
				initDataType("newest-weight", "weight-chart", "api/human/weights", "hard_coded_json/weights");
			}

			function initDataType(divId, canvasId, url, altUrl) {
				$.ajax({
					url: url,
					dataType: 'json',
					success: function(data) {
						visualizeData(divId, canvasId, data);
					},
					error: function() {
						$.ajax({
							url: altUrl,
							dataType: 'json',
							success: function(data) {
								visualizeData(divId, canvasId, data);
							}
						});
					}
				});
			}

			function visualizeData(divId, canvasId, data) {
				if (data.length != 0)
					createNewestMeasureDisplay(divId, data[data.length-1].value, data[0].unit, data[data.length-1].timestamp);
				createChart(canvasId, data);
			}

			function createNewestMeasureDisplay(divId, value, unit, time) {
				$("#" + divId).html("<i>Latest meausure (" + time + "): </i><span>" + value + "</span> " + unit);

				$("#" + divId).css("width", chartWidthFullSize / 2.0);
				$("#" + divId).css("height", chartHeightFullSize / 2.0);
				$("#" + divId).find("span:first").css("line-height", (chartHeightFullSize / 2.0 - 60) + "px");
			}

			function createChart(canvasId, data) {
				timestamps = [];
				values = [];

				for (var i = 0; i < data.length; i++) {
					timestamps.push(data[i].timestamp);
					values.push(data[i].value);
				}

				var lineChartData = {
					labels: timestamps,
					datasets: [
						{
							fillColor: "rgba(200,0,0,0.5)",
							strokeColor: "rgba(0,0,0,0.9)",
							data: values
						}
					]
				}

				var opts = {
					scaleShowLabels: true
				}

				$("#" + canvasId).attr("width", chartWidthFullSize);
				$("#" + canvasId).attr("height", chartHeightFullSize);
				new Chart($("#" + canvasId)[0].getContext("2d")).Bar(lineChartData, opts);

				if (activePageButton == "home-button") {
					$("#" + canvasId).css("width", chartWidthFullSize / 2.0);
					$("#" + canvasId).css("height", chartHeightFullSize / 2.0);
				}
			}

			function changePage(buttonId) {
				var animationTime = 400;

				updatePage();

				$("#" + buttonId).attr("class", "active");
				$("#" + activePageButton).attr("class", "");
				activePageButton = buttonId;

				switch (buttonId) {
				case "home-button":
					$("#heart-rate-chart").css("width", chartWidthFullSize / 2.0);
					$("#heart-rate-chart").css("height", chartHeightFullSize / 2.0);
					$("#weight-chart").css("width", chartWidthFullSize / 2.0);
					$("#weight-chart").css("height", chartHeightFullSize / 2.0);
					showAllDataTypes(animationTime);
					break;
				case "heart-rate-button":
					hideAllDataTypes();
					$("#heart-rate-chart").css("width", chartWidthFullSize);
					$("#heart-rate-chart").css("height", chartHeightFullSize);
					$("#heart-rate").show(animationTime);
					break;
				case "weight-button":
					hideAllDataTypes();
					$("#weight-chart").css("width", chartWidthFullSize);
					$("#weight-chart").css("height", chartHeightFullSize);
					$("#weight").show(animationTime);
					break;
				case "health-vault-button":
					hideAllDataTypes();
					$("#health-vault").show(animationTime);
					break;
				}
			}

			function showAllDataTypes(animationTime) {
				$("#heart-rate").show(animationTime);
				$("#newest-heart-rate").show(animationTime);
				$("#weight").show(animationTime);
				$("#newest-weight").show(animationTime);
				$("#health-vault").show(animationTime);
			}

			function hideAllDataTypes() {
				$("#heart-rate").hide();
				$("#newest-heart-rate").hide();
				$("#weight").hide();
				$("#newest-weight").hide();
				$("#health-vault").hide();
			}
		</script>
	</body>
</html>